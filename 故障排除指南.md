# 故障排除指南

## 常见问题及解决方案

### 1. Redis连接问题

**问题现象:**
```
Redis 客户端错误: Error: connect ECONNREFUSED ::1:6379
```

**解决方案:**

1. **检查Redis服务状态:**
   ```bash
   # Windows
   redis-server --version
   
   # 启动Redis服务
   redis-server
   ```

2. **修改Redis配置（如果需要）:**
   - 系统已自动配置为使用IPv4地址(127.0.0.1)
   - Redis连接失败不会影响系统运行，只是缓存功能不可用

3. **无Redis运行方案:**
   - 系统已设计为可在无Redis情况下运行
   - 缓存和限流功能会自动降级
   - 核心业务功能不受影响

### 2. 前端启动问题

**问题现象:**
```
npm ERR! Missing script: "dev"
```

**解决方案:**

1. **使用正确的命令:**
   ```bash
   cd frontend
   npm run serve  # 或者 npm run dev
   ```

2. **重新安装依赖:**
   ```bash
   cd frontend
   rm -rf node_modules package-lock.json
   npm install
   ```

3. **使用新的启动脚本:**
   ```bash
   ./start-local.sh  # 推荐使用这个脚本
   ```

### 3. 数据库连接问题

**问题现象:**
```
❌ 数据库连接失败
```

**解决方案:**

1. **检查MySQL服务:**
   ```bash
   # 测试数据库连接
   mysql -h 8.153.77.15 -u connect -p'Zhjh0704.' -e "SELECT 1"
   ```

2. **检查网络连接:**
   - 确保能访问外网
   - 检查防火墙设置

3. **初始化数据库:**
   ```bash
   cd backend
   mysql -h 8.153.77.15 -u connect -p'Zhjh0704.' < sql/init.sql
   ```

### 4. 端口占用问题

**问题现象:**
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决方案:**

1. **查找占用端口的进程:**
   ```bash
   # Windows
   netstat -ano | findstr :3000
   netstat -ano | findstr :8080
   
   # Linux/Mac
   lsof -i :3000
   lsof -i :8080
   ```

2. **终止占用进程:**
   ```bash
   # Windows
   taskkill /PID <PID> /F
   
   # Linux/Mac
   kill -9 <PID>
   ```

3. **修改端口配置:**
   - 后端: 修改 `backend/.env` 中的 `PORT`
   - 前端: 修改 `frontend/vue.config.js` 中的 `devServer.port`

### 5. API调用失败

**问题现象:**
```
网络连接失败，请检查网络
```

**解决方案:**

1. **检查后端服务:**
   ```bash
   curl http://localhost:3000/health
   ```

2. **检查API密钥配置:**
   - 确认 `backend/.env` 中的API密钥正确
   - DeepSeek Key: `sk-17269fe512b74407b22f5c926a216bf1`
   - Kimi Key: `sk-5WRXcCdiP1HoPDRwpcKnF0Zi5b9th6q12mF50KqBDJrUc62y`

3. **测试API接口:**
   ```bash
   ./test-api.sh
   ```

### 6. 前端依赖警告

**问题现象:**
```
npm WARN deprecated inflight@1.0.6
npm WARN deprecated eslint@8.57.1
```

**解决方案:**
- 这些是依赖包的版本警告，不影响系统运行
- 可以忽略这些警告
- 如需解决，可以升级到最新版本的CLI工具

### 7. 启动脚本权限问题

**问题现象:**
```
permission denied: ./start-local.sh
```

**解决方案:**
```bash
chmod +x start-local.sh
chmod +x stop-dev.sh
chmod +x test-api.sh
```

## 推荐的启动流程

### 1. 使用新的本地启动脚本（推荐）
```bash
./start-local.sh
```

### 2. 手动启动（调试时使用）

**后端:**
```bash
cd backend
npm install
npm run dev
```

**前端（新窗口）:**
```bash
cd frontend
npm install
npm run serve  # 或 npm run dev
```

### 3. 验证启动成功

1. **检查服务状态:**
   - 后端健康检查: http://localhost:3000/health
   - 前端界面: http://localhost:8080

2. **测试API:**
   ```bash
   ./test-api.sh
   ```

## 性能优化建议

1. **加速依赖安装:**
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```

2. **减少内存使用:**
   ```bash
   export NODE_OPTIONS="--max-old-space-size=4096"
   ```

## 开发环境要求

- **Node.js**: >= 18.x (推荐 20.x)
- **npm**: >= 8.x
- **内存**: >= 4GB
- **磁盘空间**: >= 2GB
- **网络**: 需要访问外部API

## 联系支持

如果以上解决方案都无法解决问题，请：

1. 收集错误日志
2. 记录操作系统和软件版本信息
3. 联系技术支持团队

## 快速检查清单

- [ ] Node.js版本 >= 18.x
- [ ] 端口3000和8080未被占用
- [ ] 网络连接正常
- [ ] 启动脚本有执行权限
- [ ] 环境配置文件存在
- [ ] MySQL数据库可访问
- [ ] API密钥配置正确