# 高中数学AI题库自动生成模块 - 部署说明

## 系统概述

本系统是一个基于AI技术的高中数学题目自动生成平台，采用DeepSeek-reasoner进行题目生成，Kimi-thinking-preview进行质量审核，实现了完整的题目生成→审核→落库→人工确认的业务闭环。

## 技术架构

- **前端**: Vue3 + ElementPlus + Vuex + Vue Router
- **后端**: Node.js 20 + Express 4 + MySQL 8.0 + Redis 7
- **AI模型**: DeepSeek-reasoner (生成) + Kimi-thinking-preview (审核)
- **数据库**: MySQL 8.0 (主数据存储) + Redis 7 (缓存&限流)

## 环境要求

### 基础环境
- Node.js >= 18.x (推荐 20.x)
- MySQL >= 8.0
- Redis >= 7.0 (可选，用于缓存和限流)

### API密钥
- DeepSeek API Key: `sk-17269fe512b74407b22f5c926a216bf1`
- Kimi API Key: `sk-5WRXcCdiP1HoPDRwpcKnF0Zi5b9th6q12mF50KqBDJrUc62y`

### 数据库配置
- 主机: `8.153.77.15`
- 端口: `3306`
- 数据库: `math`
- 用户: `connect`
- 密码: `Zhjh0704.`

## 快速启动

### 1. 克隆项目
```bash
git clone <repository-url>
cd multi-model
```

### 2. 环境配置
```bash
# 复制环境配置文件
cp backend/.env.example backend/.env

# 根据实际情况修改 backend/.env 中的配置
```

### 3. 一键启动开发环境
```bash
./start-dev.sh
```

启动成功后可访问：
- 前端界面: http://localhost:8080
- 后端API: http://localhost:3000
- API文档: http://localhost:3000/api/docs

### 4. 停止服务
```bash
./stop-dev.sh
# 或直接按 Ctrl+C
```

## 手动部署

### 后端部署

1. **安装依赖**
```bash
cd backend
npm install
```

2. **数据库初始化**
```bash
mysql -h 8.153.77.15 -u connect -p'Zhjh0704.' < sql/init.sql
```

3. **启动后端服务**
```bash
# 开发模式
npm run dev

# 生产模式
npm start
```

### 前端部署

1. **安装依赖**
```bash
cd frontend
npm install
```

2. **开发模式启动**
```bash
npm run serve
```

3. **生产构建**
```bash
npm run build
```

构建产物在 `dist/` 目录下，可部署到任何静态文件服务器。

## API接口文档

### 核心接口

#### 题目生成
```http
POST /api/questions/generate
Content-Type: application/json

{
  "type": "choice|blank|solution",
  "knowledgePoint": "func_basic",
  "difficulty": 1-5,
  "customPrompt": "可选的自定义要求"
}
```

#### 获取原始题目列表
```http
GET /api/questions/raw?status=auto_pass&page=1&size=50
```

#### 确认题目
```http
POST /api/questions/{id}/confirm
Content-Type: application/json

{
  "humanFeedback": "人工审核意见(可选)"
}
```

#### 拒绝题目
```http
POST /api/questions/{id}/reject
Content-Type: application/json

{
  "humanFeedback": "拒绝原因(必填)"
}
```

### 知识点接口

#### 获取所有知识点
```http
GET /api/knowledge-points
```

#### 获取知识点统计
```http
GET /api/knowledge-points/statistics
```

### 系统统计
```http
GET /api/questions/statistics
```

## 数据库表结构

### 主要数据表

1. **raw_questions** - 原始题目表
   - 存储AI生成和审核的完整流程数据
   - 包含DeepSeek生成结果和Kimi审核结果

2. **questions** - 正式题目表
   - 存储已确认的高质量题目
   - 支持全文搜索和质量评分

3. **knowledge_points** - 知识点配置表
   - 管理18个高中数学知识点
   - 支持分类和层级结构

4. **api_logs** - API调用日志表
   - 记录所有AI API调用详情
   - 用于成本分析和性能监控

## 业务流程

1. **题目生成**: 管理员在Web控制台输入生成参数
2. **AI生成**: 后端调用DeepSeek API生成题目和解析
3. **质量审核**: 自动调用Kimi API进行逻辑、计算、格式审核
4. **状态标记**: 根据审核结果标记为auto_pass或ai_reject
5. **人工确认**: 管理员在控制台查看并确认或拒绝题目
6. **正式入库**: 确认后的题目进入正式题库供使用

## 性能指标

- 单次完整流程: ≤ 25秒
- API响应超时: 30秒(自动重试2次)
- 系统可用性: ≥ 99%
- API限流: 5 requests/second
- 并发处理: 支持多题目并行生成

## 监控和日志

### 系统日志
- 后端服务日志: 控制台输出
- API调用日志: 存储在api_logs表
- 错误日志: 自动记录到数据库

### 监控指标
- 题目生成成功率
- AI审核通过率
- API响应时间
- 系统资源使用情况
- 成本统计

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查网络连接和数据库服务状态
   - 验证数据库配置参数

2. **API调用失败**
   - 检查API密钥是否正确
   - 验证网络连接和API服务状态
   - 查看API调用限额

3. **Redis连接失败**
   - Redis为可选依赖，连接失败不影响核心功能
   - 检查Redis服务状态和配置

4. **前端页面无法访问**
   - 检查前端服务是否正常启动
   - 验证端口是否被占用

### 日志查看
```bash
# 查看后端日志
cd backend && npm run dev

# 查看数据库连接状态
mysql -h 8.153.77.15 -u connect -p'Zhjh0704.' -e "SELECT 1"

# 测试API接口
./test-api.sh
```

## 安全注意事项

1. **API密钥安全**
   - 生产环境必须使用环境变量存储密钥
   - 定期轮换API密钥

2. **数据库安全**
   - 使用强密码
   - 限制数据库访问IP
   - 定期备份数据

3. **网络安全**
   - 生产环境使用HTTPS
   - 配置防火墙规则
   - 启用访问控制

## 扩展规划

1. **功能扩展**
   - 支持更多题目类型
   - 增加更多知识点
   - 添加用户权限管理

2. **性能优化**
   - 数据库分库分表
   - API缓存优化
   - 负载均衡部署

3. **智能化提升**
   - 更精准的难度控制
   - 个性化题目推荐
   - 自动化质量评估

## 联系方式

如遇技术问题，请联系技术支持团队。